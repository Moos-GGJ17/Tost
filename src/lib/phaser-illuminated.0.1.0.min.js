Phaser.Plugin.PhaserIlluminated=function(t){this._game=t,this._construct()},Phaser.Plugin.PhaserIlluminated.prototype=Object.create(Phaser.Plugin.prototype),Phaser.Plugin.PhaserIlluminated.prototype.constructor=Phaser.Plugin.Webcam,Phaser.Plugin.PhaserIlluminated.prototype._construct=function(){this._game.add.illuminated={},this._game.add.illuminated.lamp=this._createLamp,this._game.add.illuminated.darkMask=this._createDarkMask,this._game.add.illuminated.rectangleObject=this._createRectangleObject,this._game.add.illuminated.discObject=this._createDiscObject,this._game.add.illuminated.lineObject=this._createLineObject,this._game.add.illuminated.polygonObject=this._createPolygonObject,this._game.add.illuminated._illuminatedSprites=[],this._game.add.illuminated._opaqueObjects=[],this._game.add.illuminated._game=this._game,illuminated.Lamp.prototype.mask=function(t){var i=this._getVisibleMaskCache(),e=new illuminated.Vec2(Math.cos(this.angle),-Math.sin(this.angle)).mul(this.roughness*this.distance);t.drawImage(i.canvas,this.offset.x+Math.round(this.position.x+e.x-i.w/2),this.offset.y+Math.round(this.position.y+e.y-i.h/2))}},Phaser.Plugin.PhaserIlluminated.prototype._createLamp=function(t,i,e){e||(e={});var a;a=e.distance?e.distance:200,t||(t=0),i||(i=0),e.distance=a,e.position=new illuminated.Vec2(a,a);var n=game.add.bitmapData(2*a,2*a);game.cache.addBitmapData("illuminated-lamp-"+this._illuminatedSprites.length,n);var r=new illuminated.Lamp(e);r.offset={};var l=game.add.sprite(t,i,n);return l.bmdIndex="illuminated-lamp-"+this._illuminatedSprites.length,l.bmd=n,l.lamp=r,l.refresh=function(){this.bmd.ctx.clearRect(0,0,this.bmd.width,this.bmd.height),this.lighting?(this.lighting.objects.forEach(function(t){t.topleft&&t.bottomright?(t.topleft.x=t.originalX-this.x,t.topleft.y=t.originalY-this.y,t.bottomright.x=t.originalX+t.originalW-this.x,t.bottomright.y=t.originalY+t.originalH-this.y,t.syncFromTopleftBottomright()):t.radius?(t.center.x=t.originalX-this.x,t.center.y=t.originalY-this.y):t.a&&t.b?(t.a.x=t.originalStartX-this.x,t.a.y=t.originalStartY-this.y,t.b.x=t.originalEndX-this.x,t.b.y=t.originalEndY-this.y):t.points&&t.points.forEach(function(i,e){i.x=t.originalData[e].x-this.x,i.y=t.originalData[e].y-this.y},this)},this),this.lighting.compute(this.bmd.width,this.bmd.height),this.lighting.render(this.bmd.ctx)):this.lamp.render(this.bmd.ctx),this.bmd.dirty=!0,this.lamp.offset.x=this.x,this.lamp.offset.y=this.y},l.createLighting=function(t){if(!t)return null;var i=this.bmd,e=new illuminated.Lighting({light:r,objects:t});return e.compute(i.width,i.height),e.render(i.ctx),this.lighting=e,this},l.getLamp=function(){return this.lamp},l.refresh(),this._illuminatedSprites.push(l),l},Phaser.Plugin.PhaserIlluminated.prototype._createDarkMask=function(t,i){t||(t=this._game.add.illuminated._illuminatedSprites);var e=[];t.forEach(function(t){e.push(t.lamp)},this);var a=game.add.bitmapData(this._game.width,this._game.height);game.cache.addBitmapData("illuminated-darkmask",a);var n=new illuminated.DarkMask({lights:e,color:i?i:"rgba(0,0,0,0.8"});n.compute(this._game.width,this._game.height),n.render(a.ctx);var r=game.add.sprite(0,0,a);return r.darkMask=n,r.bmdIndex="illuminated-darkmask",r.bmd=a,r.refresh=function(){this.bmd.ctx.clearRect(0,0,this.bmd.width,this.bmd.height),this.darkMask.compute(this.bmd.width,this.bmd.height),this.darkMask.render(a.ctx),this.bmd.dirty=!0},r.getMask=function(){return this.darkMask},r.addLampSprite=function(t){this.darkMask.lights.push(t.lamp),this.refresh()},r},Phaser.Plugin.PhaserIlluminated.prototype._createRectangleObject=function(t,i,e,a){var n=new illuminated.RectangleObject({topleft:new illuminated.Vec2(t,i),bottomright:new illuminated.Vec2(t+e,i+a)});return n.originalX=t,n.originalY=i,n.originalW=e,n.originalH=a,n},Phaser.Plugin.PhaserIlluminated.prototype._createDiscObject=function(t,i,e){var a=new illuminated.DiscObject({position:new illuminated.Vec2(t,i),radius:e});return a.originalX=t,a.originalY=i,a},Phaser.Plugin.PhaserIlluminated.prototype._createLineObject=function(t,i,e,a){var n=new illuminated.LineObject(new illuminated.Vec2(t,i),new illuminated.Vec2(t,i));return n.originalStartX=t,n.originalStartY=i,n.originalEndX=e,n.originalEndY=a,n},Phaser.Plugin.PhaserIlluminated.prototype._createPolygonObject=function(t){var i=[];t.forEach(function(t){i.push(new illuminated.Vec2(t.x,t.y))},this);var e=new illuminated.PolygonObject({points:i});return e.originalData=t,e};